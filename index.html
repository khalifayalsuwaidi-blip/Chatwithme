<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Global Chat - Admin Commands</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
body { height: 100vh; display: flex; background: black; color: white; overflow: hidden; }
.sidebar { width: 250px; background: #111; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
.logo { font-size: 22px; font-weight: bold; margin-bottom: 20px; }
.chat-container { flex: 1; display: flex; flex-direction: column; padding: 20px; overflow-y: auto; }
.message { margin-bottom: 10px; }
.admin-message { color: #ff4444; }
.input-container { display: flex; gap: 10px; margin-top: auto; }
input[type="text"] { flex: 1; padding: 10px; border-radius: 5px; border: none; outline: none; }
button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background: white; color: black; font-weight: bold; }
.flash { position: absolute; top:0; left:0; width:100%; height:100%; background:white; opacity:0; pointer-events:none; }
.nuke-img { width:100px; margin: 10px auto; display:block; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
</head>
<body>
<div class="sidebar">
  <div class="logo">Global Chat</div>
  <button id="clearBtn" style="display:none;">Clear Chat (Admin)</button>
</div>
<div class="chat-container" id="chatContainer"></div>
<div class="input-container">
  <input type="text" id="messageInput" placeholder="Type a message...">
  <button id="sendBtn">Send</button>
</div>
<div class="flash" id="flash"></div>

<script>
const SUPABASE_URL = 'YOUR_SUPABASE_URL';
const SUPABASE_KEY = 'YOUR_SUPABASE_ANON_KEY';
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const urlParams = new URLSearchParams(window.location.search);
const username = prompt("Enter your name:") || "Guest";
const adminLink = urlParams.get('admin');
const isAdmin = adminLink === 'true';

if(isAdmin) document.getElementById('clearBtn').style.display = 'block';

// Track muted and banned users
let mutedUsers = {};
let bannedUsers = {};

const chatContainer = document.getElementById('chatContainer');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');
const clearBtn = document.getElementById('clearBtn');
const flash = document.getElementById('flash');

async function sendMessage(msg) {
  if(!msg) return;

  // Check if user is muted or banned
  if(bannedUsers[username]) { alert("You are banned!"); return; }
  if(mutedUsers[username] && mutedUsers[username] > Date.now()) { alert("You are muted!"); return; }

  // Admin commands
  if(msg.startsWith('/')) {
    const parts = msg.split(' ');
    const cmd = parts[0];
    if(!isAdmin) return alert("Only admins can use commands!");
    
    if(cmd === '/nuke') {
      displayNuke();
      return;
    }

    if(cmd === '/ban') {
      const target = parts[1];
      if(!target) return alert("Specify a username to ban");
      if(target === 'CREATOR_NAME') return alert("Cannot ban the creator!");
      bannedUsers[target] = true;
      addMessage(`ADMIN: ${target} has been banned!`, true);
      return;
    }

    if(cmd === '/mute') {
      const target = parts[1];
      let time = parseInt(parts[2]) || 0;
      if(!target) return alert("Specify a username to mute");
      if(target === 'CREATOR_NAME') return alert("Cannot mute the creator!");
      if(time > 86400) time = 86400; // max 24h
      mutedUsers[target] = Date.now() + time*1000;
      addMessage(`ADMIN: ${target} has been muted for ${time} seconds`, true);
      return;
    }
  }

  await supabase.from('messages').insert([{ user: username, message: msg }]);
}

// ===== Display Messages =====
function addMessage(msg, isAdminMsg=false) {
  const div = document.createElement('div');
  div.classList.add('message');
  if(isAdminMsg) div.classList.add('admin-message');
  div.innerHTML = msg;
  chatContainer.appendChild(div);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

async function loadMessages() {
  const { data } = await supabase.from('messages').select('*').order('id');
  chatContainer.innerHTML = '';
  data.forEach(msg => addMessage(`${msg.user}: ${msg.message}`));
}

loadMessages();

supabase.from('messages').on('INSERT', payload => {
  const msg = payload.new;
  addMessage(`${msg.user}: ${msg.message}`);
}).subscribe();

sendBtn.addEventListener('click', () => sendMessage(messageInput.value).then(() => messageInput.value=''));
messageInput.addEventListener('keypress', e => { if(e.key==='Enter') sendMessage(messageInput.value).then(() => messageInput.value=''); });

// Clear chat
clearBtn.addEventListener('click', async () => {
  if(!isAdmin) return;
  await supabase.from('messages').delete().neq('id',0);
  chatContainer.innerHTML = '';
});

// ===== Nuke Command =====
function displayNuke() {
  addMessage(`<strong>NUKE DEPLOYED!</strong> <img src="https://i.imgur.com/2bXKk3D.png" class="nuke-img">`, true);
  flash.style.opacity = '0.3';
  setTimeout(()=>{ flash.style.opacity='0'; }, 3000);
}
</script>
</body>
</html>
